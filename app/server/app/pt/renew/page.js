(()=>{var e={};e.id=3284,e.ids=[3284],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},9175:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>p,tree:()=>c}),t(84236),t(84658),t(35866);var r=t(23191),a=t(88716),l=t(37922),n=t.n(l),i=t(95231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);t.d(s,d);let c=["",{children:["pt",{children:["renew",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,84236)),"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\pt\\renew\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,84658)),"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\pt\\renew\\page.tsx"],x="/pt/renew/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/pt/renew/page",pathname:"/pt/renew",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},98857:(e,s,t)=>{Promise.resolve().then(t.bind(t,90983))},90983:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var r=t(10326),a=t(17577),l=t(35047),n=t(58864),i=t(33971);function d({session:e,onSuccess:s,onClose:t}){let[l,d]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),[x,m]=(0,a.useState)({phone:e.phone,sessionsPurchased:0,coachName:e.coachName,pricePerSession:e.pricePerSession,startDate:(()=>{if(e.expiryDate){let s=new Date(e.expiryDate),t=new Date;return s<t?(0,n.ze)(t):(0,n.ze)(s)}return(0,n.ze)(new Date)})(),expiryDate:"",paymentMethod:"cash"}),[p,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(""),b=e=>{if(!x.startDate)return;let s=new Date(new Date(x.startDate));s.setMonth(s.getMonth()+e),m(e=>({...e,expiryDate:(0,n.ze)(s)}))},j=async r=>{if(r.preventDefault(),u(!0),g(""),x.startDate&&x.expiryDate){let e=new Date(x.startDate);if(new Date(x.expiryDate)<=e){g("❌ تاريخ الانتهاء يجب أن يكون بعد تاريخ البداية"),u(!1);return}}try{let r=await fetch("/api/pt/renew",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ptNumber:e.ptNumber,...x})}),a=await r.json();if(r.ok){if(g("✅ تم تجديد جلسات PT بنجاح!"),a.receipt)try{let s=await fetch(`/api/receipts?ptNumber=${e.ptNumber}`),t=await s.json();if(t.length>0){let e=t[0];console.log("Receipt ready for print:",e)}}catch(e){console.error("Error fetching receipt:",e)}setTimeout(()=>{s(),t()},1500)}else g(`❌ ${a.error||"فشل التجديد"}`)}catch(e){console.error(e),g("❌ حدث خطأ في الاتصال")}finally{u(!1)}},f=x.startDate&&x.expiryDate?(0,n.pi)(x.startDate,x.expiryDate):null,N=x.sessionsPurchased*x.pricePerSession,y=e.sessionsRemaining+x.sessionsPurchased;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",dir:"rtl",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[r.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white p-6 rounded-t-2xl",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"\uD83D\uDD04 تجديد جلسات PT"}),r.jsx("p",{className:"text-green-100",children:"إضافة جلسات جديدة للعميل"})]}),r.jsx("button",{onClick:t,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full w-10 h-10 flex items-center justify-center transition",children:"✕"})]})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"bg-green-50 border-r-4 border-green-500 p-4 rounded-lg mb-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"رقم PT"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["#",e.ptNumber]})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"اسم العميل"}),r.jsx("p",{className:"text-lg font-bold",children:e.clientName})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"المدرب الحالي"}),r.jsx("p",{className:"text-lg",children:e.coachName})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"الجلسات المتبقية حاليًا"}),r.jsx("p",{className:"text-2xl font-bold text-orange-600",children:e.sessionsRemaining})]})]}),e.expiryDate&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-green-200",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"تاريخ الانتهاء الحالي"}),r.jsx("p",{className:"text-lg font-mono",children:(0,n.ze)(e.expiryDate)})]})]}),h&&r.jsx("div",{className:`mb-4 p-4 rounded-lg ${h.includes("✅")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:h}),(0,r.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-5",children:[(0,r.jsxs)("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCCB"}),r.jsx("span",{children:"بيانات التجديد"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم الهاتف"}),r.jsx("input",{type:"tel",value:x.phone,onChange:e=>m({...x,phone:e.target.value}),className:"w-full px-4 py-3 border-2 rounded-lg",placeholder:"01xxxxxxxxx"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["عدد الجلسات الجديدة ",r.jsx("span",{className:"text-red-600",children:"*"})]}),r.jsx("input",{type:"number",required:!0,min:"1",value:x.sessionsPurchased,onChange:e=>m({...x,sessionsPurchased:parseInt(e.target.value)||0}),className:"w-full px-4 py-3 border-2 rounded-lg text-lg",placeholder:"عدد الجلسات"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["اسم المدرب ",r.jsx("span",{className:"text-red-600",children:"*"})]}),c?r.jsx("div",{className:"w-full px-4 py-3 border-2 rounded-lg bg-gray-50 text-gray-500",children:"جاري تحميل الكوتشات..."}):0===l.length?(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("input",{type:"text",required:!0,value:x.coachName,onChange:e=>m({...x,coachName:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg",placeholder:"اسم المدرب"}),r.jsx("p",{className:"text-xs text-amber-600",children:"⚠️ لا يوجد كوتشات نشطين. يمكنك الإدخال يدوياً"})]}):(0,r.jsxs)("select",{required:!0,value:x.coachName,onChange:e=>m({...x,coachName:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg bg-white",children:[r.jsx("option",{value:"",children:"-- اختر المدرب --"}),l.map(e=>(0,r.jsxs)("option",{value:e.name,children:[e.name," ",e.phone&&`(${e.phone})`]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["سعر الجلسة ",r.jsx("span",{className:"text-red-600",children:"*"})]}),r.jsx("input",{type:"number",required:!0,min:"0",value:x.pricePerSession,onChange:e=>m({...x,pricePerSession:parseFloat(e.target.value)||0}),className:"w-full px-4 py-3 border-2 rounded-lg text-lg",placeholder:"0.00"})]})]}),(0,r.jsxs)("div",{className:"mt-4 bg-white border-2 border-blue-300 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-600",children:"الإجمالي:"}),(0,r.jsxs)("span",{className:"text-2xl font-bold text-green-600",children:[N," ج.م"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-2 text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"إجمالي الجلسات بعد التجديد:"}),(0,r.jsxs)("span",{className:"text-lg font-bold text-orange-600",children:[y," جلسة"]})]})]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-5",children:[(0,r.jsxs)("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCC5"}),r.jsx("span",{children:"فترة الاشتراك الجديدة"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["تاريخ البداية ",r.jsx("span",{className:"text-red-600",children:"*"})," ",r.jsx("span",{className:"text-xs text-gray-500",children:"(yyyy-mm-dd)"})]}),r.jsx("input",{type:"text",required:!0,value:x.startDate,onChange:e=>m({...x,startDate:e.target.value}),className:"w-full px-4 py-3 border-2 rounded-lg font-mono text-lg",placeholder:"2025-11-18",pattern:"\\d{4}-\\d{2}-\\d{2}"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["تاريخ الانتهاء ",r.jsx("span",{className:"text-red-600",children:"*"})," ",r.jsx("span",{className:"text-xs text-gray-500",children:"(yyyy-mm-dd)"})]}),r.jsx("input",{type:"text",required:!0,value:x.expiryDate,onChange:e=>m({...x,expiryDate:e.target.value}),className:"w-full px-4 py-3 border-2 rounded-lg font-mono text-lg",placeholder:"2025-12-18",pattern:"\\d{4}-\\d{2}-\\d{2}"})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("p",{className:"text-sm font-medium mb-2",children:"⚡ إضافة سريعة:"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,6,9,12].map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>b(e),className:"px-3 py-2 bg-purple-100 hover:bg-purple-200 text-purple-800 rounded-lg text-sm transition font-medium",children:["+ ",e," ",1===e?"شهر":"أشهر"]},e))})]}),null!==f&&x.expiryDate&&r.jsx("div",{className:"bg-white border-2 border-purple-300 rounded-lg p-4",children:f>0?(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-3xl",children:"⏱️"}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-bold text-purple-800 mb-1",children:"مدة الاشتراك الجديدة:"}),r.jsx("p",{className:"text-xl font-mono",children:(0,n.DL)(f)})]})]}):(0,r.jsxs)("p",{className:"text-red-600 flex items-center gap-2",children:[r.jsx("span",{children:"❌"}),r.jsx("span",{children:"تاريخ الانتهاء يجب أن يكون بعد تاريخ البداية"})]})})]}),r.jsx("div",{className:"bg-gradient-to-br from-green-50 to-blue-50 border-2 border-green-200 rounded-xl p-5",children:r.jsx(i.ZP,{value:x.paymentMethod,onChange:e=>m({...x,paymentMethod:e}),required:!0})}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-xl p-6",children:[(0,r.jsxs)("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCCA"}),r.jsx("span",{children:"ملخص التجديد"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"الجلسات الحالية:"}),(0,r.jsxs)("span",{className:"font-bold",children:[e.sessionsRemaining," جلسة"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"الجلسات الجديدة:"}),(0,r.jsxs)("span",{className:"font-bold text-green-600",children:["+ ",x.sessionsPurchased," جلسة"]})]}),r.jsx("div",{className:"border-t-2 border-gray-300 pt-3",children:(0,r.jsxs)("div",{className:"flex justify-between text-xl",children:[r.jsx("span",{className:"font-bold",children:"الإجمالي بعد التجديد:"}),(0,r.jsxs)("span",{className:"font-bold text-orange-600",children:[y," جلسة"]})]})}),r.jsx("div",{className:"bg-green-100 border-r-4 border-green-500 p-3 rounded mt-3",children:(0,r.jsxs)("div",{className:"flex justify-between text-lg",children:[r.jsx("span",{className:"font-bold text-gray-800",children:"المبلغ المدفوع:"}),(0,r.jsxs)("span",{className:"font-bold text-green-600",children:[N," ج.م"]})]})})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("button",{type:"submit",disabled:p||null!==f&&f<=0,className:"flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 disabled:bg-gray-400 transition font-bold text-lg",children:p?"جاري التجديد...":"✅ تجديد الجلسات"}),r.jsx("button",{type:"button",onClick:t,disabled:p,className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 transition font-medium",children:"إلغاء"})]})]})]})]})})}function c(){let e=(0,l.useRouter)(),s=(0,l.useSearchParams)().get("ptNumber"),[t,n]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0),[o,x]=(0,a.useState)("");return s?i?(0,r.jsxs)("div",{className:"container mx-auto p-6 text-center",dir:"rtl",children:[r.jsx("div",{className:"text-6xl mb-4",children:"⏳"}),r.jsx("p",{className:"text-xl text-gray-600",children:"جاري التحميل..."})]}):o||!t?r.jsx("div",{className:"container mx-auto p-6 text-center",dir:"rtl",children:(0,r.jsxs)("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-8",children:[r.jsx("div",{className:"text-6xl mb-4",children:"❌"}),r.jsx("h2",{className:"text-2xl font-bold mb-2",children:o||"جلسة PT غير موجودة"}),r.jsx("button",{onClick:()=>e.push("/pt"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"العودة لصفحة PT"})]})}):r.jsx(d,{session:t,onSuccess:()=>{e.push("/pt")},onClose:()=>{e.push("/pt")}}):r.jsx("div",{className:"container mx-auto p-6 text-center",dir:"rtl",children:(0,r.jsxs)("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-8",children:[r.jsx("div",{className:"text-6xl mb-4",children:"❌"}),r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"رقم PT غير محدد"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"يرجى تحديد رقم PT للتجديد"}),r.jsx("button",{onClick:()=>e.push("/pt"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"العودة لصفحة PT"})]})})}function o(){return r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"container mx-auto p-6 text-center",children:"جاري التحميل..."}),children:r.jsx(c,{})})}},33971:(e,s,t)=>{"use strict";t.d(s,{ZP:()=>a});var r=t(10326);function a({value:e,onChange:s,required:t=!1}){let a=[{value:"cash",label:"كاش \uD83D\uDCB5",icon:"\uD83D\uDCB5",color:"bg-green-100 border-green-500"},{value:"visa",label:"فيزا \uD83D\uDCB3",icon:"\uD83D\uDCB3",color:"bg-blue-100 border-blue-500"},{value:"instapay",label:"إنستا باي \uD83D\uDCF1",icon:"\uD83D\uDCF1",color:"bg-purple-100 border-purple-500"},{value:"wallet",label:"محفظة إلكترونية \uD83D\uDCB0",icon:"\uD83D\uDCB0",color:"bg-orange-100 border-orange-500"}];return(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["طريقة الدفع ",t&&r.jsx("span",{className:"text-red-600",children:"*"})]}),r.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.map(t=>(0,r.jsxs)("button",{type:"button",onClick:()=>s(t.value),className:`
              flex items-center justify-center gap-2 p-4 rounded-lg border-2 transition-all
              ${e===t.value?`${t.color} border-2 shadow-md scale-105`:"bg-white border-gray-300 hover:border-gray-400"}
            `,children:[r.jsx("span",{className:"text-3xl",children:t.icon}),r.jsx("span",{className:"font-medium text-sm",children:t.label})]},t.value))}),e&&r.jsx("div",{className:"mt-3 text-center",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["الطريقة المختارة:",r.jsx("span",{className:"font-bold text-blue-600 mr-1",children:a.find(s=>s.value===e)?.label})]})})]})}},58864:(e,s,t)=>{"use strict";function r(e){if(!e)return"-";let s="string"==typeof e?new Date(e):e;if(isNaN(s.getTime()))return"-";let t=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${t}-${r}-${a}`}function a(e,s){let t="string"==typeof e?new Date(e):e;return Math.ceil((("string"==typeof s?new Date(s):s).getTime()-t.getTime())/864e5)}function l(e){if(!e)return null;let s="string"==typeof e?new Date(e):e,t=new Date;return t.setHours(0,0,0,0),a(t,s)}function n(e){if(e<30)return`${e} يوم`;let s=Math.round(e/30);return`${e} يوم (≈ ${s} ${1===s?"شهر":"أشهر"})`}t.d(s,{DL:()=>n,pi:()=>a,rY:()=>l,ze:()=>r})},84236:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(68570).createProxy)(String.raw`C:\Users\amran\Desktop\gym\gym-management\app\pt\renew\page.tsx#default`)},57481:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(66621);let a=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,9206,6621,9797],()=>t(9175));module.exports=r})();
"use strict";(()=>{var e={};e.id=6460,e.ids=[6460],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14193:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>v,routeModule:()=>w,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{DELETE:()=>c,GET:()=>l,POST:()=>p,PUT:()=>d});var s=r(49303),n=r(88716),a=r(60670),i=r(87070),u=r(72331);async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("visitorId");if(!r)return i.NextResponse.json({error:"معرف الزائر مطلوب"},{status:400});let o=await u._.followUp.findMany({where:{visitorId:r},orderBy:{createdAt:"desc"},include:{visitor:{select:{name:!0,phone:!0}}}});return i.NextResponse.json(o)}catch(e){return console.error("GET FollowUp Error:",e),i.NextResponse.json({error:"فشل جلب المتابعات"},{status:500})}}async function p(e){try{let{visitorId:t,notes:r,contacted:o,nextFollowUpDate:s,result:n}=await e.json();if(!t||!r)return i.NextResponse.json({error:"معرف الزائر والملاحظات مطلوبان"},{status:400});if(!await u._.visitor.findUnique({where:{id:t}}))return i.NextResponse.json({error:"الزائر غير موجود"},{status:404});let a=await u._.followUp.create({data:{visitorId:t,notes:r.trim(),contacted:o||!1,nextFollowUpDate:s?new Date(s):null,result:n?.trim()}});return"subscribed"===n?await u._.visitor.update({where:{id:t},data:{status:"subscribed"}}):"not-interested"===n?await u._.visitor.update({where:{id:t},data:{status:"rejected"}}):o&&await u._.visitor.update({where:{id:t},data:{status:"contacted"}}),i.NextResponse.json(a,{status:201})}catch(e){return console.error("POST FollowUp Error:",e),i.NextResponse.json({error:"فشل إضافة المتابعة"},{status:500})}}async function d(e){try{let{id:t,notes:r,contacted:o,nextFollowUpDate:s,result:n}=await e.json();if(!t)return i.NextResponse.json({error:"معرف المتابعة مطلوب"},{status:400});let a={};void 0!==r&&(a.notes=r.trim()),void 0!==o&&(a.contacted=o),void 0!==s&&(a.nextFollowUpDate=s?new Date(s):null),void 0!==n&&(a.result=n?.trim());let l=await u._.followUp.update({where:{id:t},data:a});return i.NextResponse.json(l)}catch(e){return console.error("PUT FollowUp Error:",e),i.NextResponse.json({error:"فشل التحديث"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"معرف المتابعة مطلوب"},{status:400});return await u._.followUp.delete({where:{id:r}}),i.NextResponse.json({message:"تم الحذف بنجاح"})}catch(e){return console.error("DELETE FollowUp Error:",e),i.NextResponse.json({error:"فشل الحذف"},{status:500})}}let w=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/visitors/followups/route",pathname:"/api/visitors/followups",filename:"route",bundlePath:"app/api/visitors/followups/route"},resolvedPagePath:"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\api\\visitors\\followups\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:f}=w,m="/api/visitors/followups/route";function h(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},72331:(e,t,r)=>{r.d(t,{_:()=>s});var o=r(53524);let s=globalThis.prisma??new o.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972],()=>r(14193));module.exports=o})();
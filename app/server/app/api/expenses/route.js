"use strict";(()=>{var e={};e.id=6879,e.ids=[6879],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},35459:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>R,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>j,staticGenerationAsyncStorage:()=>m});var r={};t.r(r),t.d(r,{DELETE:()=>l,GET:()=>c,POST:()=>d,PUT:()=>x});var n=t(49303),o=t(88716),a=t(60670),i=t(87070),u=t(72331),p=t(60167);async function c(e){try{await (0,p.Ql)(e,"canViewFinancials");let{searchParams:s}=new URL(e.url),t=s.get("type"),r=s.get("staffId"),n={};t&&(n.type=t),r&&(n.staffId=r);let o=await u._.expense.findMany({where:n,orderBy:{createdAt:"desc"},include:{staff:!0}});return i.NextResponse.json(o)}catch(e){if(console.error("Error fetching expenses:",e),"Unauthorized"===e.message)return i.NextResponse.json({error:"يجب تسجيل الدخول أولاً"},{status:401});if(e.message.includes("Forbidden"))return i.NextResponse.json({error:"ليس لديك صلاحية عرض المصروفات"},{status:403});return i.NextResponse.json({error:"فشل جلب المصروفات"},{status:500})}}async function d(e){try{await (0,p.Ql)(e,"canAccessSettings");let{type:s,amount:t,description:r,notes:n,staffId:o}=await e.json();if(!s||!t||!r)return i.NextResponse.json({error:"البيانات المطلوبة ناقصة"},{status:400});let a=await u._.expense.create({data:{type:s,amount:t,description:r,notes:n,staffId:o||null},include:{staff:!0}});return i.NextResponse.json(a,{status:201})}catch(e){if(console.error("Error creating expense:",e),"Unauthorized"===e.message)return i.NextResponse.json({error:"يجب تسجيل الدخول أولاً"},{status:401});if(e.message.includes("Forbidden"))return i.NextResponse.json({error:"ليس لديك صلاحية إضافة مصروفات"},{status:403});return i.NextResponse.json({error:"فشل إضافة المصروف"},{status:500})}}async function x(e){try{await (0,p.Ql)(e,"canAccessSettings");let{id:s,...t}=await e.json(),r=await u._.expense.update({where:{id:s},data:t,include:{staff:!0}});return i.NextResponse.json(r)}catch(e){if(console.error("Error updating expense:",e),"Unauthorized"===e.message)return i.NextResponse.json({error:"يجب تسجيل الدخول أولاً"},{status:401});if(e.message.includes("Forbidden"))return i.NextResponse.json({error:"ليس لديك صلاحية تعديل المصروفات"},{status:403});return i.NextResponse.json({error:"فشل تحديث المصروف"},{status:500})}}async function l(e){try{await (0,p.Ql)(e,"canAccessSettings");let{searchParams:s}=new URL(e.url),t=s.get("id");if(!t)return i.NextResponse.json({error:"رقم المصروف مطلوب"},{status:400});return await u._.expense.delete({where:{id:t}}),i.NextResponse.json({message:"تم الحذف بنجاح"})}catch(e){if(console.error("Error deleting expense:",e),"Unauthorized"===e.message)return i.NextResponse.json({error:"يجب تسجيل الدخول أولاً"},{status:401});if(e.message.includes("Forbidden"))return i.NextResponse.json({error:"ليس لديك صلاحية حذف المصروفات"},{status:403});return i.NextResponse.json({error:"فشل حذف المصروف"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/expenses/route",pathname:"/api/expenses",filename:"route",bundlePath:"app/api/expenses/route"},resolvedPagePath:"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\api\\expenses\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:j}=f,R="/api/expenses/route";function h(){return(0,a.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:m})}},72331:(e,s,t)=>{t.d(s,{_:()=>n});var r=t(53524);let n=globalThis.prisma??new r.PrismaClient}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,5972,1482,167],()=>t(35459));module.exports=r})();
"use strict";(()=>{var e={};e.id=1996,e.ids=[1996],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},36560:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var n={};a.r(n),a.d(n,{DELETE:()=>f,GET:()=>d,POST:()=>u});var r=a(49303),s=a(88716),o=a(60670),i=a(87070),c=a(72331);async function d(e){try{let{searchParams:t}=new URL(e.url),a=t.get("staffId"),n=t.get("today"),r=t.get("date"),s={};if(a&&(s.staffId=a),"true"===n){let e=new Date;e.setHours(0,0,0,0);let t=new Date;t.setHours(23,59,59,999),s.checkIn={gte:e,lte:t}}else if(r){let e=new Date(r),t=new Date(e);t.setHours(0,0,0,0);let a=new Date(e);a.setHours(23,59,59,999),s.checkIn={gte:t,lte:a}}let o=await c._.attendance.findMany({where:s,include:{staff:!0},orderBy:{checkIn:"desc"}});return i.NextResponse.json(o)}catch(e){return console.error("Error fetching attendance:",e),i.NextResponse.json({error:"ÙØ´Ù„ Ø¬Ù„Ø¨ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±"},{status:500})}}async function u(e){try{let{staffCode:t}=await e.json();if(!t)return i.NextResponse.json({error:"Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø·Ù„ÙˆØ¨"},{status:400});let a=await c._.staff.findUnique({where:{staffCode:parseInt(t)}});if(!a)return i.NextResponse.json({error:`âŒ Ø§Ù„Ù…ÙˆØ¸Ù Ø±Ù‚Ù… ${t} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`,action:"error"},{status:404});if(!a.isActive)return i.NextResponse.json({error:`âŒ Ø§Ù„Ù…ÙˆØ¸Ù ${a.name} ØºÙŠØ± Ù†Ø´Ø·`,action:"error"},{status:400});let n=new Date;n.setHours(0,0,0,0);let r=await c._.attendance.findFirst({where:{staffId:a.id,checkIn:{gte:n}},orderBy:{checkIn:"desc"}});if(!r){let e=await c._.attendance.create({data:{staffId:a.id,checkIn:new Date},include:{staff:!0}});return i.NextResponse.json({action:"check-in",message:`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ${a.name}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ`,staffCode:a.staffCode,staffName:a.name,time:new Date().toLocaleTimeString("ar-EG"),attendance:e})}if(r.checkOut){let e=await c._.attendance.create({data:{staffId:a.id,checkIn:new Date,notes:"Ø¹ÙˆØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù"},include:{staff:!0}});return i.NextResponse.json({action:"check-in",message:`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ${a.name}!`,staffCode:a.staffCode,staffName:a.name,time:new Date().toLocaleTimeString("ar-EG"),attendance:e})}let s=new Date,o=Math.floor((s.getTime()-r.checkIn.getTime())/6e4);if(o<1)return i.NextResponse.json({error:"ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!",action:"error"},{status:400});let d=await c._.attendance.update({where:{id:r.id},data:{checkOut:s,duration:o},include:{staff:!0}}),u=Math.floor(o/60),f=o%60;return i.NextResponse.json({action:"check-out",message:`ğŸ‘‹ Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ${a.name}!`,staffCode:a.staffCode,staffName:a.name,time:s.toLocaleTimeString("ar-EG"),duration:`${u} Ø³Ø§Ø¹Ø© Ùˆ ${f} Ø¯Ù‚ÙŠÙ‚Ø©`,totalMinutes:o,attendance:d})}catch(e){return console.error("Error recording attendance:",e),i.NextResponse.json({error:"ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù",action:"error"},{status:500})}}async function f(e){try{let{searchParams:t}=new URL(e.url),a=t.get("id");if(!a)return i.NextResponse.json({error:"Ù…Ø¹Ø±Ù Ø§Ù„Ø³Ø¬Ù„ Ù…Ø·Ù„ÙˆØ¨"},{status:400});return await c._.attendance.delete({where:{id:a}}),i.NextResponse.json({message:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­"})}catch(e){return console.error("Error deleting attendance:",e),i.NextResponse.json({error:"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/attendance/route",pathname:"/api/attendance",filename:"route",bundlePath:"app/api/attendance/route"},resolvedPagePath:"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\api\\attendance\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:h}=l,g="/api/attendance/route";function w(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},72331:(e,t,a)=>{a.d(t,{_:()=>r});var n=a(53524);let r=globalThis.prisma??new n.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>a(36560));module.exports=n})();
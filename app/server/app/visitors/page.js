(()=>{var e={};e.id=7741,e.ids=[7741],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},6423:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>r.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>d}),t(58444),t(84658),t(35866);var a=t(23191),l=t(88716),n=t(37922),r=t.n(n),o=t(95231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);t.d(s,i);let d=["",{children:["visitors",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,58444)),"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\visitors\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,84658)),"C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\amran\\Desktop\\gym\\gym-management\\app\\visitors\\page.tsx"],x="/visitors/page",u={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/visitors/page",pathname:"/visitors",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},76591:(e,s,t)=>{Promise.resolve().then(t.bind(t,90601))},90601:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(10326),l=t(17577);function n(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)([]),[r,o]=(0,l.useState)(!1),[i,d]=(0,l.useState)(!1),[c,x]=(0,l.useState)(null),[u,m]=(0,l.useState)(!0),[p,h]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[j,f]=(0,l.useState)("all"),[v,y]=(0,l.useState)({name:"",phone:"",notes:"",source:"walk-in",interestedIn:""}),[N,w]=(0,l.useState)({notes:"",contacted:!1,nextFollowUpDate:"",result:"",salesName:""}),k=async()=>{try{let e=new URLSearchParams;g&&e.append("search",g),"all"!==j&&e.append("status",j);let t=await fetch(`/api/visitors?${e}`),a=await t.json();s(a.visitors||[]),n(a.stats||[])}catch(e){console.error("Error:",e)}finally{m(!1)}},C=async e=>{e.preventDefault(),m(!0),h("");try{let e=await fetch("/api/visitors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}),s=await e.json();e.ok?(y({name:"",phone:"",notes:"",source:"walk-in",interestedIn:""}),h("✅ تم إضافة الزائر بنجاح!"),setTimeout(()=>h(""),3e3),k(),o(!1)):(h(`❌ ${s.error||"فشل إضافة الزائر"}`),setTimeout(()=>h(""),5e3))}catch(e){console.error(e),h("❌ حدث خطأ")}finally{m(!1)}},D=async e=>{if(e.preventDefault(),c){m(!0);try{let e=await fetch("/api/visitors/followups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:c.id,...N})});if(e.ok)w({notes:"",contacted:!1,nextFollowUpDate:"",result:"",salesName:""}),h("✅ تم إضافة المتابعة بنجاح!"),setTimeout(()=>h(""),3e3),k(),d(!1),x(null);else{let s=await e.json();h(`❌ ${s.error||"فشل إضافة المتابعة"}`)}}catch(e){console.error(e),h("❌ حدث خطأ")}finally{m(!1)}}},S=e=>a.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${{pending:"bg-yellow-100 text-yellow-800",contacted:"bg-blue-100 text-blue-800",subscribed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"}`,children:{pending:"معلق",contacted:"تم التواصل",subscribed:"مشترك",rejected:"مرفوض"}[e]||e}),P=e=>({"walk-in":"زيارة مباشرة",facebook:"فيسبوك",instagram:"إنستجرام",friend:"صديق",other:"أخرى"})[e]||e;return(0,a.jsxs)("div",{className:"container mx-auto p-6",dir:"rtl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الزوار"}),a.jsx("button",{onClick:()=>o(!r),className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700",children:r?"إخفاء النموذج":"➕ إضافة زائر جديد"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-gray-500 text-sm",children:"إجمالي الزوار"}),a.jsx("div",{className:"text-2xl font-bold",children:e.length})]}),t.map(e=>(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"text-gray-500 text-sm",children:["pending"===e.status&&"معلق","contacted"===e.status&&"تم التواصل","subscribed"===e.status&&"مشترك","rejected"===e.status&&"مرفوض"]}),a.jsx("div",{className:"text-2xl font-bold",children:e._count})]},e.status))]})]}),p&&a.jsx("div",{className:`mb-4 p-3 rounded-lg ${p.includes("✅")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p}),r&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"إضافة زائر جديد"}),(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"الاسم *"}),a.jsx("input",{type:"text",required:!0,value:v.name,onChange:e=>y({...v,name:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"اسم الزائر"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"رقم الهاتف *"}),a.jsx("input",{type:"tel",required:!0,value:v.phone,onChange:e=>y({...v,phone:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"01xxxxxxxxx",pattern:"^(010|011|012|015)[0-9]{8}$",title:"يجب أن يبدأ الرقم بـ 010، 011، 012، أو 015 ويتكون من 11 رقم"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"مصدر الزائر"}),(0,a.jsxs)("select",{value:v.source,onChange:e=>y({...v,source:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[a.jsx("option",{value:"walk-in",children:"زيارة مباشرة"}),a.jsx("option",{value:"facebook",children:"فيسبوك"}),a.jsx("option",{value:"instagram",children:"إنستجرام"}),a.jsx("option",{value:"friend",children:"صديق"}),a.jsx("option",{value:"other",children:"أخرى"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"مهتم بـ"}),a.jsx("input",{type:"text",value:v.interestedIn,onChange:e=>y({...v,interestedIn:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"مثال: جيم، كلاسات، تدريب شخصي"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"ملاحظات"}),a.jsx("textarea",{value:v.notes,onChange:e=>y({...v,notes:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",rows:3,placeholder:"أي ملاحظات عن الزائر..."})]}),a.jsx("button",{type:"submit",disabled:u,className:"w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:u?"جاري الحفظ...":"إضافة زائر"})]})]}),i&&c&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6 border-2 border-blue-500",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["إضافة متابعة لـ ",c.name]}),(0,a.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"اسم البائع *"}),a.jsx("input",{type:"text",required:!0,value:N.salesName,onChange:e=>w({...N,salesName:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"من الذي قام بالمتابعة؟"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"ملاحظات المتابعة *"}),a.jsx("textarea",{required:!0,value:N.notes,onChange:e=>w({...N,notes:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"ماذا حدث في هذه المتابعة؟"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[a.jsx("div",{children:(0,a.jsxs)("label",{className:"flex items-center space-x-2 space-x-reverse",children:[a.jsx("input",{type:"checkbox",checked:N.contacted,onChange:e=>w({...N,contacted:e.target.checked}),className:"rounded"}),a.jsx("span",{className:"text-sm font-medium",children:"تم التواصل"})]})}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"النتيجة"}),(0,a.jsxs)("select",{value:N.result,onChange:e=>w({...N,result:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"-- اختر --"}),a.jsx("option",{value:"interested",children:"مهتم"}),a.jsx("option",{value:"not-interested",children:"غير مهتم"}),a.jsx("option",{value:"postponed",children:"مؤجل"}),a.jsx("option",{value:"subscribed",children:"اشترك"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"متابعة قادمة"}),a.jsx("input",{type:"date",value:N.nextFollowUpDate,onChange:e=>w({...N,nextFollowUpDate:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{type:"submit",disabled:u,className:"flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:u?"جاري الحفظ...":"حفظ المتابعة"}),a.jsx("button",{type:"button",onClick:()=>{d(!1),x(null),w({notes:"",contacted:!1,nextFollowUpDate:"",result:"",salesName:""})},className:"px-6 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400",children:"إلغاء"})]})]})]}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow-md mb-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"بحث"}),a.jsx("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"ابحث بالاسم أو رقم الهاتف..."})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"فلتر حسب الحالة"}),(0,a.jsxs)("select",{value:j,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[a.jsx("option",{value:"all",children:"الكل"}),a.jsx("option",{value:"pending",children:"معلق"}),a.jsx("option",{value:"contacted",children:"تم التواصل"}),a.jsx("option",{value:"subscribed",children:"مشترك"}),a.jsx("option",{value:"rejected",children:"مرفوض"})]})]})]})}),u?a.jsx("div",{className:"text-center py-12",children:"جاري التحميل..."}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,a.jsxs)("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-right",children:"الاسم"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"رقم الهاتف"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"المصدر"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"مهتم بـ"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"الحالة"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"آخر متابعة"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"تاريخ الزيارة"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"إجراءات"})]})}),a.jsx("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 font-medium",children:e.name}),a.jsx("td",{className:"px-4 py-3 font-mono text-sm",children:e.phone}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:P(e.source)}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.interestedIn||"-"}),a.jsx("td",{className:"px-4 py-3",children:S(e.status)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:e.followUps&&e.followUps.length>0?(0,a.jsxs)("div",{className:"max-w-xs",children:[e.followUps[0].salesName&&(0,a.jsxs)("div",{className:"text-orange-600 font-medium text-xs mb-1",children:["\uD83D\uDC64 ",e.followUps[0].salesName]}),a.jsx("div",{className:"text-gray-600 truncate",children:e.followUps[0].notes}),a.jsx("div",{className:"text-xs text-gray-400",children:new Date(e.followUps[0].createdAt).toLocaleDateString("ar-EG")})]}):a.jsx("span",{className:"text-gray-400",children:"لا توجد متابعات"})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(e.createdAt).toLocaleDateString("ar-EG")}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("div",{className:"flex gap-2",children:a.jsx("button",{onClick:()=>{x(e),d(!0)},className:"text-blue-600 hover:text-blue-800 text-l px-4",title:"إضافة متابعة",children:"\uD83D\uDCDDمتابعه"})})})]},e.id))})]}),0===e.length&&a.jsx("div",{className:"text-center py-12 text-gray-500",children:"لا يوجد زوار حالياً"})]})]})}},58444:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`C:\Users\amran\Desktop\gym\gym-management\app\visitors\page.tsx#default`)},57481:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var a=t(66621);let l=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[8948,9206,6621,9797],()=>t(6423));module.exports=a})();